# IncBossesAbility_Actions
**_IncBossesAbility_Actions_** - это способность для плагина **IncBosses**, добавляющая возможность выполнения различных действий при спавне, смерти или смене фаз босса!

## Использование
Чтобы использовать способность, вам достаточно всего лишь загрузить **_.jar_** файл способности и переместить его в папку **_plugins/IncBosses/abilities_**

Чтобы использовать способность в фазе босса, вам нужно создать секцию для новой способности и указать её название:
```yaml
abilities:
  actions:
    ability: IncBossesAbility_Actions
```
Также в этой секции вам нужно указать параметры для этой способности

## Параметры
Прежде чем описывать параметры конфига, в которых определяются действия, нужно рассказать, как эти действия указываются и настраиваются

**Action** - это строка определёного формата, которая используется для настройки действий. Формат данной строки следующий:

`[действие(настройки)] аргумент`

### действие
Это обязательный элемент. Он обозначает то, какое действие будет совершено

Список всех встроенных действий, а так же способ создания своих собственных действий будут описаны далее

### аргумент
Это элемент, наличие и формат которого зависит от действия. Каким-то действиям необходимы аргументы, каким-то нет

### настройки
Это необязательный элемент. Он позволяет настроить выполнение действия

Если вы не хотите настраивать действие, то можете не писать круглые скобки. В таком случае строка будет иметь такой формат: `[действие] аргумент`

Настройки имеют формат `параметр=значение` и указываются через `;`

У всех действий есть только 3 настройки:

#### delay
- Использование: `delay`, `del` или `d`
- Тип значения: **TimeMetric**
```
TimeMetric - это строка с форматом <число>[tick|t|sec|s|min|m|hour|h],
которая позволяет удобно задавать временные значения

Пример:
- 10tick или 10t - 10 тиков
- 10sec или 10s - 10 секунд
- 10min или 10m - 10 минут
- 10hour или 10h - 10 часов
```
- Значение по умолчанию: `0t`

  Задаёт задержку перед выполнением действия

#### period
- Использование: `period`, `per` или `p`
- Тип значения: **TimeMetric**
- Значение по умолчанию: `0t`

  Задаёт период с которым выполняется действие

#### repeats
- Использование: `repeats`, `rep` или `r`
- Тип значения: **Integer**
- Значение по умолчанию: `1`

- Задаёт количество повторений действия (Значение должно быть неотрицательным)

  Если вместо значения указать `while_phase`, то действие будет повторяться до тех пор, пока не закончится текущая фаза

  Если вместо значения указать `while_alive`, то действие будет повторяться пока босс жив

Также необходимо упомянуть то, что действия бывают двух типов:
- **BossAction** (Действие, которое совершается относительно босса)
- **PlayerAction** (Действие, которое совершается относительно игрока)

Их подробное описание и различия будут описаны ниже

А сейчас давайте перейдём к самим параметрам конфига!

---

### start-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при старте фазы

### start-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при старте фазы для игроков, находящихся в [start-players-actions-radius](#start-players-actions-radius) блоках от босса

### start-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [start-players-actions](#start-players-actions)

### start-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при старте фазы для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

### stop-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при остановке фазы

### stop-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при остановке фазы для игроков, находящихся в [stop-players-actions-radius](#stop-players-actions-radius) блоках от босса

### stop-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [stop-players-actions](#stop-players-actions)

### stop-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при остановке фазы для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

### spawn-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при спавне босса

### spawn-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при спавне босса для игроков, находящихся в [spawn-players-actions-radius](#spawn-players-actions-radius) блоках от босса

### spawn-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [spawn-players-actions](#spawn-players-actions)

### spawn-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при спавне босса для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

### death-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при смерти босса

### death-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при смерти босса для игроков, находящихся в [death-players-actions-radius](#death-players-actions-radius) блоках от босса

### death-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [death-players-actions](#death-players-actions)

### death-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при смерти босса для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

### not-spawn-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при старте фазы, но не при спавне босса

### not-spawn-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при старте фазы, но не при спавне босса, для игроков, находящихся в [not-spawn-players-actions-radius](#not-spawn-players-actions-radius) блоках от босса

### not-spawn-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [not-spawn-players-actions](#not-spawn-players-actions)

### not-spawn-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при старте фазы, но не при спавне босса, для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

### not-death-actions
Тип данных: **List\<BossAction>**

Список действий босса, которые выполняются при остановке фазы, но не при смерти босса

### not-death-players-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при остановке фазы, но не при смерти босса, для игроков, находящихся в [not-death-players-actions-radius](#not-death-players-actions-radius) блоках от босса

### not-death-players-actions-radius
Тип данных: **Double**\
Значение по умолчанию: **10**

Радиус, в пределах которого для игроков срабатывают действия, указанные в [not-death-players-actions](#not-death-players-actions)

### not-death-fighters-actions
Тип данных: **List\<PlayerAction>**

Список действий, которые выполняются при остановке фазы, но не при смерти босса, для всех игроков, когда-либо наносивших урон боссу, независимо от расстояния до них

---

Как вы могли заметить, все эти параметры по своей сути одинаковы. Меняется только приставка, которая означает условие выполнения действий. На основе этих данных можно построить таблицу, в которой можно быстро узнать, какие действия выполняются при определённых условиях смены фаз:

| Приставка | Спавн босса | Смерть босса | Старт фазы<br/>(Не из-за спавна босса) | Остановка фазы<br/>(Не из-за смерти босса) |
|-----------|:-----------:|:------------:|:--------------------------------------:|:------------------------------------------:|
| start     |      ✅      |      ❌       |                   ✅                    |                     ❌                      |
| stop      |      ❌      |      ✅       |                   ❌                    |                     ✅                      |
| spawn     |      ✅      |      ❌       |                   ❌                    |                     ❌                      |
| death     |      ❌      |      ✅       |                   ❌                    |                     ❌                      |
| not-spawn |      ❌      |      ❌       |                   ✅                    |                     ❌                      |
| not-death |      ❌      |      ❌       |                   ❌                    |                     ✅                      |

Надеемся, что назначение параметров вам стало ясно. А теперь давайте перейдём к более подробному обсуждению действий

## Действия

Как мы уже упоминали, действия бывают двух типов: **PlayerAction** и **BossAction**, однако мы так и не объяснили подробно, чем они различаются

Все действия совершаются относительно какой-то сущности, и, как понятно из названия, **BossAction** выполняется относительно босса, а **PlayerAction** - относительно игрока. Это значит, что, например, действие `effect` может накладывать эффект как на босса, так и на игроков, в зависимости от того, в каком параметре оно используется

Далее перечислены все доступные встроенные действия

### BossActions

---
- **console**
  
  Выполняет команду в консоли

  _Аргумент:_ `<команда>`
---
- **command**
  
  Выполняет команду в консоли (От лица босса)

  _Аргумент:_ `<команда>`
---
- **sound**
  
  Проигрывает звук в позиции босса

  _Аргумент:_ `<звук>:<громкость>:<высота>`
---
- **attribute**
  
  Изменяет аттрибут сущности босса

  _Аргумент:_ `<аттрибут>:<значение>`
---
- **particles**
  
  Создаёт частицу в позиции босса

  _Аргумент:_ `<частица>:<количество>`
---
- **push**
  
  Отталкивает игроков в указанном радиусе с указанной силой (если сила отрицательная, то притягивает)

  _Аргумент:_ `<радиус>:<сила>`
---
- **effect**
  
  Накладывает на босса эффект на указанное количество тиков

  _Аргумент:_ `<эффект>:<уровень>:<длительность>`

### PlayerActions

---
- **message**

  Отправляет игроку сообщение в чат

  _Аргумент:_ `<сообщение>`
---
- **console**

  Выполняет команду в консоли

  _Аргумент:_ `<команда>`
---
- **command**

  Выполняет команду в консоли (От лица игрока)

  _Аргумент:_ `<команда>`
---
- **sound**

  Проигрывает звук в игроку

  _Аргумент:_ `<звук>:<громкость>:<высота>`
---
- **particles**

  Создаёт частицу в позиции игрока

  _Аргумент:_ `<частица>:<количество>`
---
- **effect**

  Накладывает на игрока эффект на указанное количество тиков

  _Аргумент:_ `<эффект>:<уровень>:<длительность>`

### Кастомные действия

Выше мы упомянули возможность создавать собственные действия. В этом разделе будет подробно описан этот способ

#### Nashorn

_Nashorn_ — это движок, способный выполнять код на языке _JavaScript_, а также использовать в коде классы и методы языка _Java_

Благодаря ему можно создавать модули для Java программ, которыми, в нашем случае, и являются кастомные действия

#### Создание скрипта

При первом запуске способность создаёт папку `plugins/IncBosses/abilities/IncBossesAbility_Actions`, а в ней две другие: `bosses` и `players`. В этих папках будут находиться скрипты кастомных **BossAction** и **PlayerAction** соответственно

Давайте создадим наш первый скрипт!

Мы будем создавать простой скрипт, который поджигает всех игроков в определённом радиусе. Следовательно это будет действие для игроков. Мы назовём это действие `fire`

Теперь в папке `players` создаеём файл `fire.js` (название действия зависит от названия файла). Теперь мы можем использовать это действие в параметрах, использующих действия для игроков. Например, в _**start-players-actions**_
```yaml
abilities:
  actions:
    ability: IncBossesAbility_Actions
    start-players-actions:
      - '[fire]'
```
Однако пока что это действие ничего не делает. Пора это исправить!

Мы хотим сделать так, чтобы игрок поджигался на определённое количество тиков, которое мы сможем указывать в аргументе. При выполнении кастомного действия в движок **_Nashorn_** передаются следующие данные:

- **BossAction**

  `arg` - Аргумент действия

  `boss` - Объект, в котором находится информация о боссе, и через который можно управлять боссом _(см. описание класса [**Boss**](https://github.com/IncrementStudio/IncBossesAbilitiesAPI?tab=readme-ov-file#boss) в **IncBossesAbilitiesAPI**)_

- **PlayerAction**

  `arg` - Аргумент действия

  `boss` - Объект, в котором находится информация о боссе, и через который можно управлять боссом

  `player` - Игрок, над которым совершается действие

Мы хотим проверить, указан ли аргумент, и если указан, то конвертировать строку аргумента в целое число и передать его в метод _**setFireTicks**_, который вызывается для объекта `player`

Тогда наш скрипт будет выглядеть так:

```js
if (arg != null) {
	time = parseInt(arg);
	player.setFireTicks(time);
}
```

Теперь мы можем настроить способность так, чтобы в течении всей фазы каждую секунду всех игроков в радиусе 5 блоков поджигало на 2 секунды:
```yaml
abilities:
  actions:
    ability: IncBossesAbility_Actions
    start-players-actions-radius: 5
    start-players-actions:
      - '[fire(r=while_phase;p=1s)] 40'
```

Таким образом можно создавать абсолютно любые действия, имея даже небольшие знания **_Nashorn JS_** и _**Java**!_

Статьи, которые могут помочь вам в изучении _**Nashorn**_:
- [Введение в Nashorn](https://habr.com/ru/articles/195870/) _(Русский)_
- [Introduction to Nashorn](https://www.baeldung.com/java-nashorn) _(Английский)_
---
<p align="right">С наилучшими пожеланиями<br>Команда IncrementStudio++</p>